

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>PyOpenGLng.HighLevelApi.Shader &mdash; PyOpenGLng 0.1.0 documentation</title>
    
    <link rel="stylesheet" href="../../../static/PyOpenGLng.css" type="text/css" />
    <link rel="stylesheet" href="../../../static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../static/jquery.js"></script>
    <script type="text/javascript" src="../../../static/underscore.js"></script>
    <script type="text/javascript" src="../../../static/doctools.js"></script>
    <link rel="top" title="PyOpenGLng 0.1.0 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">PyOpenGLng 0.1.0 documentation</a> &raquo;</li>
          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for PyOpenGLng.HighLevelApi.Shader</h1><div class="highlight"><pre>
<span class="c">####################################################################################################</span>
<span class="c">#</span>
<span class="c"># PyOpenGLng - An OpenGL Python Wrapper with a High Level API.</span>
<span class="c"># Copyright (C) 2013 Salvaire Fabrice</span>
<span class="c">#</span>
<span class="c">####################################################################################################</span>

<span class="sd">&quot;&quot;&quot; This modules provides classes to manager OpenGL Shader.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c">####################################################################################################</span>
<span class="c">#</span>
<span class="c">#                                              Audit</span>
<span class="c">#</span>
<span class="c"># - 15/01/2013 Fabrice</span>
<span class="c">#  location versus index, binding point</span>
<span class="c">#</span>
<span class="c">####################################################################################################</span>

<span class="c">####################################################################################################</span>
<span class="c">#</span>
<span class="c"># glGetUniformBlockIndex: retrieve the index of a named uniform block</span>
<span class="c"># glGetUniformIndices: retrieves the indices of a number of uniforms within program</span>
<span class="c"># </span>
<span class="c">####################################################################################################</span>

<span class="c">####################################################################################################</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="c">####################################################################################################</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">GL</span>
<span class="kn">from</span> <span class="nn">..Tools.AttributeDictionaryInterface</span> <span class="kn">import</span> <span class="p">(</span><span class="n">AttributeDictionaryInterface</span><span class="p">,</span> <span class="n">AttributeDictionaryInterfaceDescriptor</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">..Tools.Singleton</span> <span class="kn">import</span> <span class="n">SingletonMetaClass</span>
<span class="kn">import</span> <span class="nn">OpenGlExt</span> <span class="kn">as</span> <span class="nn">GL_Ext</span>
<span class="kn">import</span> <span class="nn">Type</span> <span class="kn">as</span> <span class="nn">GlType</span>

<span class="c">####################################################################################################</span>

<span class="n">_module_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="c">####################################################################################################</span>

<div class="viewcode-block" id="GlShader"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShader">[docs]</a><span class="k">class</span> <span class="nc">GlShader</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; This class defines a shader source code.</span>

<span class="sd">    Instances have an internal source code buffer to accumulate the source code before to compile</span>
<span class="sd">    it.  We can get the content of this buffer using the :func:`str`.  And we can test if the shader</span>
<span class="sd">    is compiled using a Boolean evaluation of the instance.</span>

<span class="sd">    The shader type can be passed to the constructor or retrieved from a source file, where a</span>
<span class="sd">    comment line with the following pattern must be present::</span>
<span class="sd">        </span>
<span class="sd">          // #shader_type SHADER_TYPE</span>
<span class="sd">        </span>
<span class="sd">    where *SHADER_TYPE* could be either *vertex*, *fragment* and *geometry*. It is case insensitive.</span>

<span class="sd">    Source files are preprocessed so as to replace line of the form::</span>

<span class="sd">      #include(file.glsl)</span>
<span class="sd">    </span>
<span class="sd">    the path is relative to the parent source file.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_logger</span> <span class="o">=</span> <span class="n">_module_logger</span><span class="o">.</span><span class="n">getChild</span><span class="p">(</span><span class="s">&#39;GlShader&#39;</span><span class="p">)</span>

    <span class="c"># Fixme: use enumerate class?</span>
    <span class="n">FRAGMENT_SHADER</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_FRAGMENT_SHADER</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">GL</span><span class="p">,</span> <span class="s">&#39;GL_GEOMETRY_SHADER&#39;</span><span class="p">):</span>
        <span class="n">GEOMETRY_SHADER</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_GEOMETRY_SHADER</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">GEOMETRY_SHADER</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># Fixme: from wrapper TypeError: an integer is required</span>
    <span class="n">VERTEX_SHADER</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_VERTEX_SHADER</span>
    <span class="c"># TESSELATION_CONTROL_SHADER = GL.GL_TESS_CONTROL_SHADER</span>
    <span class="c"># TESSELATION_EVALUATION_SHADER = GL.GL_TESS_EVALUATION_SHADER</span>

    <span class="n">SHADER_TYPES</span> <span class="o">=</span> <span class="p">(</span><span class="n">VERTEX_SHADER</span><span class="p">,</span>
                    <span class="n">FRAGMENT_SHADER</span><span class="p">,</span>
                    <span class="n">GEOMETRY_SHADER</span><span class="p">,</span>
                    <span class="c"># TESSELATION_CONTROL_SHADER,</span>
                    <span class="c"># TESSELATION_EVALUATION_SHADER,</span>
                    <span class="p">)</span>

    <span class="c">##############################################</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shader_type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">source_code</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">shader_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_shader_type</span><span class="p">(</span><span class="n">shader_type</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_shader_type</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clear_source</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">source_code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_from_string</span><span class="p">(</span><span class="n">source_code</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">file_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_from_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_shader_id</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">glCreateShader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shader_type</span><span class="p">)</span>

    <span class="c">##############################################</span>
    
    <span class="k">def</span> <span class="nf">__delx__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c"># Fixme: delx</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">(</span><span class="s">&quot;Delete Shader </span><span class="si">%u</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shader_id</span><span class="p">))</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glDeleteShader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shader_id</span><span class="p">)</span>

    <span class="c">##############################################</span>
    
    <span class="k">def</span> <span class="nf">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compiled</span>

    <span class="c">##############################################</span>
    
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source</span>

    <span class="c">##############################################</span>
    
<div class="viewcode-block" id="GlShader.clear_source"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShader.clear_source">[docs]</a>    <span class="k">def</span> <span class="nf">clear_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Clear the internal source code buffer. &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_source</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compiled</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="c">##############################################</span>
</div>
<div class="viewcode-block" id="GlShader._set_shader_type"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShader._set_shader_type">[docs]</a>    <span class="k">def</span> <span class="nf">_set_shader_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shader_type</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Set the shader type.  It raise an exception if the shader is already set. &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shader_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&quot;Shader type is already defined&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">shader_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SHADER_TYPES</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Wrong shader type&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shader_type</span> <span class="o">=</span> <span class="n">shader_type</span>

    <span class="c">##############################################</span>
</div>
<div class="viewcode-block" id="GlShader._set_shader_type_from_source_code"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShader._set_shader_type_from_source_code">[docs]</a>    <span class="k">def</span> <span class="nf">_set_shader_type_from_source_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Set the shader type from the source code. &quot;&quot;&quot;</span>

        <span class="n">shader_type_pattern</span> <span class="o">=</span> <span class="s">&#39;// #shader_type&#39;</span>
        <span class="n">start_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">shader_type_pattern</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">start_position</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">stop_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">start_position</span><span class="p">)</span>
            <span class="n">shader_type_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source</span><span class="p">[</span><span class="n">start_position</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">shader_type_pattern</span><span class="p">):</span><span class="n">stop_position</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">shader_type</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shader_type_name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;_SHADER&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_shader_type</span><span class="p">(</span><span class="n">shader_type</span><span class="p">)</span>

    <span class="c">##############################################</span>
    </div>
<div class="viewcode-block" id="GlShader.load_from_string"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShader.load_from_string">[docs]</a>    <span class="k">def</span> <span class="nf">load_from_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Append the source string to the internal buffer. &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_source</span> <span class="o">+=</span> <span class="n">source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compiled</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="c">##############################################</span>
    </div>
<div class="viewcode-block" id="GlShader._preprocessor"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShader._preprocessor">[docs]</a>    <span class="k">def</span> <span class="nf">_preprocessor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_code</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Preprocess the source code. &quot;&quot;&quot;</span>

        <span class="c"># Fixme: remove commented lines!</span>
        <span class="n">include_start_pattern</span> <span class="o">=</span> <span class="s">&#39;#include(&#39;</span>
        <span class="n">include_stop_pattern</span> <span class="o">=</span> <span class="s">&#39;)&#39;</span>
        <span class="n">current_position</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">include_start_position</span> <span class="o">=</span> <span class="n">source_code</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">include_start_pattern</span><span class="p">,</span> <span class="n">current_position</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">include_start_position</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">include_stop_position</span> <span class="o">=</span> <span class="n">source_code</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">include_stop_pattern</span><span class="p">,</span> <span class="n">include_start_position</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">include_stop_position</span><span class="p">:</span>
                    <span class="n">include_file_name</span> <span class="o">=</span> <span class="n">source_code</span><span class="p">[</span><span class="n">include_start_position</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">include_start_pattern</span><span class="p">):</span><span class="n">include_stop_position</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Include GLSL file </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">include_file_name</span><span class="p">))</span>
                    <span class="c"># Fixme: implement -I like search path</span>
                    <span class="n">include_source_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">include_file_name</span><span class="p">))</span>
                    <span class="n">current_position</span> <span class="o">=</span> <span class="n">include_stop_position</span> <span class="o">+</span><span class="mi">1</span>
                    <span class="n">source_code</span> <span class="o">=</span> <span class="n">source_code</span><span class="p">[:</span><span class="n">include_start_position</span><span class="p">]</span> \
                        <span class="o">+</span> <span class="s">&#39;/* Begin include &#39;</span> <span class="o">+</span> <span class="n">include_file_name</span> <span class="o">+</span> <span class="s">&#39; */</span><span class="se">\n</span><span class="s">&#39;</span> \
                        <span class="o">+</span> <span class="n">include_source_code</span> \
                        <span class="o">+</span> <span class="s">&#39;/* End include &#39;</span> <span class="o">+</span> <span class="n">include_file_name</span> <span class="o">+</span> <span class="s">&#39; */</span><span class="se">\n</span><span class="s">&#39;</span> \
                        <span class="o">+</span> <span class="n">source_code</span><span class="p">[</span><span class="n">current_position</span><span class="p">:]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">line_count</span> <span class="o">=</span> <span class="n">source_code</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">include_start_position</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Malformed include at line </span><span class="si">%u</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">line_count</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
                    
        <span class="k">return</span> <span class="n">source_code</span>

    <span class="c">##############################################</span>
    </div>
<div class="viewcode-block" id="GlShader._load_from_file"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShader._load_from_file">[docs]</a>    <span class="k">def</span> <span class="nf">_load_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Load source code from file and preprocess it. &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">source_code</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">source_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocessor</span><span class="p">(</span><span class="n">source_code</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">source_code</span>

    <span class="c">##############################################</span>
    </div>
<div class="viewcode-block" id="GlShader.load_from_file"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShader.load_from_file">[docs]</a>    <span class="k">def</span> <span class="nf">load_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Load the source code from the file given by *file_name*, preprocess it and append it to</span>
<span class="sd">        the internal buffer. The shader type is determined from the source.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load_from_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_load_from_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_shader_type_from_source_code</span><span class="p">()</span>

    <span class="c">##############################################</span>
    </div>
<div class="viewcode-block" id="GlShader.compile"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShader.compile">[docs]</a>    <span class="k">def</span> <span class="nf">compile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Compile the shader. &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Empty source code shader&#39;</span><span class="p">)</span>

        <span class="n">GL</span><span class="o">.</span><span class="n">glShaderSource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shader_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source</span><span class="p">)</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glCompileShader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shader_id</span><span class="p">)</span>

        <span class="n">log</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">glGetShaderInfoLog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shader_id</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">Compile Shader:</span>
<span class="s">  -----------------------------------------------------------------------------</span>
<span class="si">%s</span><span class="s"></span>
<span class="s">  -----------------------------------------------------------------------------</span>
<span class="s">Log:</span>
<span class="s">  -----------------------------------------------------------------------------</span>
<span class="si">%s</span><span class="s"></span>
<span class="s">  -----------------------------------------------------------------------------</span>
<span class="s">&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">message</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_source</span><span class="p">,</span> <span class="n">log</span><span class="p">))</span>

        <span class="c"># Fixme: high level function</span>
        <span class="c"># Fixme: shader doesn&#39;t have name</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">GL_Ext</span><span class="o">.</span><span class="n">glGetShaderiv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shader_id</span><span class="p">,</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_COMPILE_STATUS</span><span class="p">):</span>
            <span class="n">source_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
            <span class="n">last_line</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">source_lines</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span>
            <span class="c"># Fixme: count digit of last_line</span>
            <span class="n">source_lines</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;</span><span class="si">%3u</span><span class="s">| &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">location</span><span class="p">)</span> <span class="o">+</span> <span class="n">source_lines</span><span class="p">[</span><span class="n">location</span><span class="p">]</span>
                            <span class="k">for</span> <span class="n">location</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">last_line</span> <span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Source:</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">source_lines</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">log</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
                <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&#39;\d\((\d+)\) : error&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                <span class="c"># intel: # 0:18(10): error: no precision specified this scope for type `vec4&#39;</span>
                <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">location</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                    <span class="n">context_size</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">lower_location</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">location</span><span class="o">-</span><span class="n">context_size</span><span class="p">)</span>
                    <span class="n">upper_location</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">location</span><span class="o">+</span><span class="n">context_size</span><span class="p">,</span> <span class="n">last_line</span><span class="p">)</span>
                    <span class="n">context_source_lines</span> <span class="o">=</span> <span class="n">source_lines</span><span class="p">[</span><span class="n">lower_location</span><span class="p">:</span><span class="n">upper_location</span> <span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="n">line</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">context_source_lines</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;GLSL Compilation Error&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_compiled</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c">####################################################################################################</span>
</div></div>
<div class="viewcode-block" id="sorted_by_location"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.sorted_by_location">[docs]</a><span class="k">def</span> <span class="nf">sorted_by_location</span><span class="p">(</span><span class="n">a_list</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">a_list</span><span class="p">,</span> <span class="nb">cmp</span><span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">cmp</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">_location</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">_location</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="sorted_by_offset"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.sorted_by_offset">[docs]</a><span class="k">def</span> <span class="nf">sorted_by_offset</span><span class="p">(</span><span class="n">a_list</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">a_list</span><span class="p">,</span> <span class="nb">cmp</span><span class="o">=</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">cmp</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">_offset</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">_offset</span><span class="p">))</span>

<span class="c">####################################################################################################</span>
</div>
<div class="viewcode-block" id="GlVariable"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlVariable">[docs]</a><span class="k">class</span> <span class="nc">GlVariable</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; This class is a base class for Attributes and Uniforms. &quot;&quot;&quot;</span>

    <span class="c">#: This attribute is used to set the variable label: attribute or uniform.</span>
    <span class="n">VARIABLE_LABEL</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c">##############################################</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shader_program</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">gl_type</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
                 <span class="n">within_uniform_block</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">offset</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                 <span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; The argument *shader_program* is the :class:`GlShaderProgram` instance, *name* is the</span>
<span class="sd">        name of the uniform in the source code, *location* is the location of the uniform, *gl_type*</span>
<span class="sd">        the OpenGL data type and *size* is the number of elements of the uniform.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_shader_program</span> <span class="o">=</span> <span class="n">shader_program</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_location</span> <span class="o">=</span> <span class="n">location</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gl_type</span> <span class="o">=</span> <span class="n">gl_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">=</span> <span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_within_uniform_block</span> <span class="o">=</span> <span class="n">within_uniform_block</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_offset</span> <span class="o">=</span> <span class="n">offset</span>

    <span class="c">##############################################</span>
    
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">size_text</span> <span class="o">=</span> <span class="s">&#39;[</span><span class="si">%u</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">size_text</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">template</span> <span class="o">=</span> <span class="s">&#39; </span><span class="si">%(_name)s</span><span class="s"> = </span><span class="si">%(_gl_type)s</span><span class="s">&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_within_uniform_block</span><span class="p">:</span>
            <span class="n">template</span> <span class="o">=</span> <span class="s">&#39;[offset: </span><span class="si">%(_offset)3u</span><span class="s">]&#39;</span> <span class="o">+</span> <span class="n">template</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">VARIABLE_LABEL</span> <span class="o">+</span> <span class="s">&#39;[</span><span class="si">%(_location)2u</span><span class="s">]&#39;</span> <span class="o">+</span> <span class="n">template</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">template</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span> <span class="o">+</span> <span class="n">size_text</span>

<span class="c">####################################################################################################</span>
</div>
<div class="viewcode-block" id="GlUniform"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlUniform">[docs]</a><span class="k">class</span> <span class="nc">GlUniform</span><span class="p">(</span><span class="n">GlVariable</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; This class defines a uniform within a shader program. &quot;&quot;&quot;</span>

    <span class="n">VARIABLE_LABEL</span> <span class="o">=</span> <span class="s">&#39;Uniform&#39;</span>

    <span class="c">##############################################</span>
    
<div class="viewcode-block" id="GlUniform.get"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlUniform.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Return the uniform value(s). &quot;&quot;&quot;</span>

        <span class="c"># Fixme check</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gl_type</span><span class="o">.</span><span class="n">uniform_get_v</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shader_program</span><span class="o">.</span><span class="n">program_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_location</span><span class="p">)</span>

    <span class="c">##############################################</span>
    </div>
<div class="viewcode-block" id="GlUniform.set"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlUniform.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Set the uniform value(s). &quot;&quot;&quot;</span>

        <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">value</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_gl_type</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gl_type</span><span class="o">.</span><span class="n">program_uniform_set_v</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shader_program</span><span class="o">.</span><span class="n">program_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_location</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="c"># self._gl_type.uniform_set(self._location, value) # require binding</span>

<span class="c">####################################################################################################</span>
</div></div>
<div class="viewcode-block" id="GlUniformSampler"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlUniformSampler">[docs]</a><span class="k">class</span> <span class="nc">GlUniformSampler</span><span class="p">(</span><span class="n">GlUniform</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; This class defines a sampler uniform. &quot;&quot;&quot;</span>

    <span class="k">pass</span>

<span class="c">####################################################################################################</span>
</div>
<div class="viewcode-block" id="GlUniformVariable"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlUniformVariable">[docs]</a><span class="k">class</span> <span class="nc">GlUniformVariable</span><span class="p">(</span><span class="n">GlUniform</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; This class defines a variable uniform. &quot;&quot;&quot;</span>

    <span class="k">pass</span>

<span class="c">####################################################################################################</span>
</div>
<div class="viewcode-block" id="GlUniformNd"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlUniformNd">[docs]</a><span class="k">class</span> <span class="nc">GlUniformNd</span><span class="p">(</span><span class="n">GlUniform</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; This class is a base class for vector and matrix uniforms. &quot;&quot;&quot;</span>

    <span class="c">##############################################</span>
    
<div class="viewcode-block" id="GlUniformNd.get"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlUniformNd.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Return the uniform value(s). &quot;&quot;&quot;</span>

        <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gl_type</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_gl_type</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gl_type</span><span class="o">.</span><span class="n">uniform_get_v</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shader_program</span><span class="o">.</span><span class="n">program_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_location</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span>

    <span class="c">##############################################</span>
    </div>
<div class="viewcode-block" id="GlUniformNd._check_value"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlUniformNd._check_value">[docs]</a>    <span class="k">def</span> <span class="nf">_check_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Check the value dimension and shape. &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gl_type</span><span class="o">.</span><span class="n">number_of_dimensions</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Wrong array dimension for </span><span class="si">%s</span><span class="s"> = </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gl_type</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gl_type</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Wrong array shape for </span><span class="si">%s</span><span class="s"> = </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_gl_type</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

<span class="c">####################################################################################################</span>
</div></div>
<div class="viewcode-block" id="GlUniformVector"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlUniformVector">[docs]</a><span class="k">class</span> <span class="nc">GlUniformVector</span><span class="p">(</span><span class="n">GlUniformNd</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; This class defines a vector uniform. &quot;&quot;&quot;</span>

    <span class="c">##############################################</span>
    
<div class="viewcode-block" id="GlUniformVector.set"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlUniformVector.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Set the uniform value(s). &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_gl_type</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="c">#!# self._gl_type.program_uniform_set_v(self._shader_program.program_id, self._location, 1, value)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gl_type</span><span class="o">.</span><span class="n">uniform_set_v</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_location</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="c"># require binding</span>

<span class="c">####################################################################################################</span>
</div></div>
<div class="viewcode-block" id="GlUniformMatrix"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlUniformMatrix">[docs]</a><span class="k">class</span> <span class="nc">GlUniformMatrix</span><span class="p">(</span><span class="n">GlUniformNd</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; This class defines a matrix uniform. &quot;&quot;&quot;</span>

    <span class="c">##############################################</span>
    
<div class="viewcode-block" id="GlUniformMatrix.set"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlUniformMatrix.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Set the uniform value(s). &quot;&quot;&quot;</span>

        <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_gl_type</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="c"># tranpose = True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gl_type</span><span class="o">.</span><span class="n">program_uniform_set_v</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_shader_program</span><span class="o">.</span><span class="n">program_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_location</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="c"># self._gl_type.uniform_set_v(self._location, 1, True, value) # require binding</span>

<span class="c">####################################################################################################</span>
</div></div>
<div class="viewcode-block" id="GlShaderProgramUniforms"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShaderProgramUniforms">[docs]</a><span class="k">class</span> <span class="nc">GlShaderProgramUniforms</span><span class="p">(</span><span class="n">AttributeDictionaryInterfaceDescriptor</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; This class is a wrapper to access the uniforms within a shader program. &quot;&quot;&quot;</span>

    <span class="c">##############################################</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shader_program</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">GlShaderProgramUniforms</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

        <span class="n">program_id</span> <span class="o">=</span> <span class="n">shader_program</span><span class="o">.</span><span class="n">program_id</span>
        <span class="n">number_of_active_uniforms</span> <span class="o">=</span> <span class="n">GL_Ext</span><span class="o">.</span><span class="n">glGetProgramiv</span><span class="p">(</span><span class="n">program_id</span><span class="p">,</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_ACTIVE_UNIFORMS</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">number_of_active_uniforms</span><span class="p">):</span>

            <span class="n">name</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">gl_type_id</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">glGetActiveUniform</span><span class="p">(</span><span class="n">program_id</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="n">location</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">glGetUniformLocation</span><span class="p">(</span><span class="n">program_id</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">location</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="c"># uniform block</span>
                <span class="k">continue</span>

            <span class="n">gl_type</span> <span class="o">=</span> <span class="n">GlType</span><span class="o">.</span><span class="n">gl_types</span><span class="p">[</span><span class="n">gl_type_id</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&quot;Array uniform is not implemented&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gl_type</span><span class="p">,</span> <span class="n">GlType</span><span class="o">.</span><span class="n">GlVariableType</span><span class="p">):</span>
                <span class="n">cls</span> <span class="o">=</span> <span class="n">GlUniformVariable</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gl_type</span><span class="p">,</span> <span class="n">GlType</span><span class="o">.</span><span class="n">GlVectorType</span><span class="p">):</span>
                <span class="n">cls</span> <span class="o">=</span> <span class="n">GlUniformVector</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gl_type</span><span class="p">,</span> <span class="n">GlType</span><span class="o">.</span><span class="n">GlMatrixType</span><span class="p">):</span>
                <span class="n">cls</span> <span class="o">=</span> <span class="n">GlUniformMatrix</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gl_type</span><span class="p">,</span> <span class="n">GlType</span><span class="o">.</span><span class="n">GlSamplerType</span><span class="p">):</span>
                <span class="n">cls</span> <span class="o">=</span> <span class="n">GlUniformSampler</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

            <span class="n">instance</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">shader_program</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">gl_type</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dictionary</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">instance</span>

<span class="c">####################################################################################################</span>
</div>
<div class="viewcode-block" id="GlUniformBlock"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlUniformBlock">[docs]</a><span class="k">class</span> <span class="nc">GlUniformBlock</span><span class="p">(</span><span class="n">AttributeDictionaryInterface</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; This class defines an uniform block. &quot;&quot;&quot;</span>

    <span class="c">##############################################</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">uniforms</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">GlUniformBlock</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

        <span class="nb">object</span><span class="o">.</span><span class="n">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;_uniform_block_name&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="nb">object</span><span class="o">.</span><span class="n">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;_uniform_block_location&#39;</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">uniform</span> <span class="ow">in</span> <span class="n">uniforms</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dictionary</span><span class="p">[</span><span class="n">uniform</span><span class="o">.</span><span class="n">_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">uniform</span>

    <span class="c">##############################################</span>
    
<div class="viewcode-block" id="GlUniformBlock.uniform_block_name"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlUniformBlock.uniform_block_name">[docs]</a>    <span class="k">def</span> <span class="nf">uniform_block_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uniform_block_name</span>

    <span class="c">##############################################</span>
    </div>
<div class="viewcode-block" id="GlUniformBlock.uniform_block_location"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlUniformBlock.uniform_block_location">[docs]</a>    <span class="k">def</span> <span class="nf">uniform_block_location</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uniform_block_location</span>

    <span class="c">##############################################</span>
    </div>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;Uniform Block[</span><span class="si">%2u</span><span class="s">]: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uniform_block_location</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniform_block_name</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">uniform</span> <span class="ow">in</span> <span class="n">sorted_by_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s">&#39; - </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">uniform</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>

        <span class="k">return</span> <span class="n">text</span>

<span class="c">####################################################################################################</span>
</div>
<div class="viewcode-block" id="GlShaderProgramUniformBlocks"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShaderProgramUniformBlocks">[docs]</a><span class="k">class</span> <span class="nc">GlShaderProgramUniformBlocks</span><span class="p">(</span><span class="n">AttributeDictionaryInterface</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; This class is a wrapper to access the uniform blocks within a shader program. &quot;&quot;&quot;</span>

    <span class="c">##############################################</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shader_program</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">GlShaderProgramUniformBlocks</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

        <span class="n">program_id</span> <span class="o">=</span> <span class="n">shader_program</span><span class="o">.</span><span class="n">program_id</span>

        <span class="n">number_of_active_uniform_blocks</span> <span class="o">=</span> <span class="n">GL_Ext</span><span class="o">.</span><span class="n">glGetProgramiv</span><span class="p">(</span><span class="n">program_id</span><span class="p">,</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_ACTIVE_UNIFORM_BLOCKS</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">uniform_block_location</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">number_of_active_uniform_blocks</span><span class="p">):</span>
            <span class="n">uniform_block_name</span> <span class="o">=</span> <span class="n">GL_Ext</span><span class="o">.</span><span class="n">glGetActiveUniformBlockName</span><span class="p">(</span><span class="n">program_id</span><span class="p">,</span> <span class="n">uniform_block_location</span><span class="p">)</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">GL_Ext</span><span class="o">.</span><span class="n">glGetActiveUniformBlockiv</span><span class="p">(</span><span class="n">program_id</span><span class="p">,</span> <span class="n">uniform_block_location</span><span class="p">,</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES</span><span class="p">)</span>
            <span class="c"># Fixme:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">):</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">indices</span><span class="p">),)</span>
            <span class="n">uniforms</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                <span class="c"># Fixme: Mesa ?</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="n">name</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">gl_type_id</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">glGetActiveUniform</span><span class="p">(</span><span class="n">program_id</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">GL_Ext</span><span class="o">.</span><span class="n">glGetActiveUniformsiv</span><span class="p">(</span><span class="n">program_id</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_UNIFORM_OFFSET</span><span class="p">)</span>
                <span class="n">gl_type</span> <span class="o">=</span> <span class="n">GlType</span><span class="o">.</span><span class="n">gl_types</span><span class="p">[</span><span class="n">gl_type_id</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&quot;Array uniform is not implemented&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gl_type</span><span class="p">,</span> <span class="n">GlType</span><span class="o">.</span><span class="n">GlVariableType</span><span class="p">):</span>
                    <span class="n">cls</span> <span class="o">=</span> <span class="n">GlUniformVariable</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gl_type</span><span class="p">,</span> <span class="n">GlType</span><span class="o">.</span><span class="n">GlVectorType</span><span class="p">):</span>
                    <span class="n">cls</span> <span class="o">=</span> <span class="n">GlUniformVector</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gl_type</span><span class="p">,</span> <span class="n">GlType</span><span class="o">.</span><span class="n">GlMatrixType</span><span class="p">):</span>
                    <span class="n">cls</span> <span class="o">=</span> <span class="n">GlUniformMatrix</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gl_type</span><span class="p">,</span> <span class="n">GlType</span><span class="o">.</span><span class="n">GlSamplerType</span><span class="p">):</span>
                    <span class="n">cls</span> <span class="o">=</span> <span class="n">GlUniformSampler</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

                <span class="n">instance</span> <span class="o">=</span> <span class="n">cls</span><span class="p">(</span><span class="n">shader_program</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">gl_type</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
                               <span class="n">within_uniform_block</span><span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span>
                <span class="n">uniforms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dictionary</span><span class="p">[</span><span class="n">uniform_block_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">GlUniformBlock</span><span class="p">(</span><span class="n">uniform_block_name</span><span class="p">,</span> <span class="n">uniform_block_location</span><span class="p">,</span> <span class="n">uniforms</span><span class="p">)</span>

<span class="c">####################################################################################################</span>
</div>
<div class="viewcode-block" id="GlVertexAttribute"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlVertexAttribute">[docs]</a><span class="k">class</span> <span class="nc">GlVertexAttribute</span><span class="p">(</span><span class="n">GlVariable</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; This class defines a vertex attributes. &quot;&quot;&quot;</span>

    <span class="n">VARIABLE_LABEL</span> <span class="o">=</span> <span class="s">&#39;Attribute&#39;</span>

    <span class="c">##############################################</span>
    
<div class="viewcode-block" id="GlVertexAttribute.bind_to_buffer"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlVertexAttribute.bind_to_buffer">[docs]</a>    <span class="k">def</span> <span class="nf">bind_to_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vbo</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Bind the vertex attribute to a Vertex Buffer Object. &quot;&quot;&quot;</span>

        <span class="n">vbo</span><span class="o">.</span><span class="n">bind_at_location</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_location</span><span class="p">)</span>

<span class="c">####################################################################################################</span>
</div></div>
<div class="viewcode-block" id="GlShaderProgramAttributes"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShaderProgramAttributes">[docs]</a><span class="k">class</span> <span class="nc">GlShaderProgramAttributes</span><span class="p">(</span><span class="n">AttributeDictionaryInterface</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; This class is a wrapper to access the vertex attributes within a shader program. &quot;&quot;&quot;</span>

    <span class="c">##############################################</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shader_program</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">GlShaderProgramAttributes</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

        <span class="n">program_id</span> <span class="o">=</span> <span class="n">shader_program</span><span class="o">.</span><span class="n">program_id</span>
        
        <span class="n">number_of_active_attributes</span> <span class="o">=</span> <span class="n">GL_Ext</span><span class="o">.</span><span class="n">glGetProgramiv</span><span class="p">(</span><span class="n">program_id</span><span class="p">,</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_ACTIVE_ATTRIBUTES</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">number_of_active_attributes</span><span class="p">):</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">gl_type_id</span> <span class="o">=</span>  <span class="n">GL</span><span class="o">.</span><span class="n">glGetActiveAttrib</span><span class="p">(</span><span class="n">program_id</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="n">location</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">glGetAttribLocation</span><span class="p">(</span><span class="n">program_id</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">gl_type</span> <span class="o">=</span> <span class="n">GlType</span><span class="o">.</span><span class="n">gl_types</span><span class="p">[</span><span class="n">gl_type_id</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dictionary</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">GlVertexAttribute</span><span class="p">(</span><span class="n">shader_program</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">gl_type</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

    <span class="c">##############################################</span>
    
    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

<span class="c">####################################################################################################</span>
</div>
<div class="viewcode-block" id="GlShaderProgramInterfaceUniformBlock"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShaderProgramInterfaceUniformBlock">[docs]</a><span class="k">class</span> <span class="nc">GlShaderProgramInterfaceUniformBlock</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; This class defines a programming interface for an uniform block as a pair (name,</span>
<span class="sd">    binding_point)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c">##############################################</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">binding_point</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binding_point</span> <span class="o">=</span> <span class="n">binding_point</span>

<span class="c">####################################################################################################</span>
</div>
<div class="viewcode-block" id="GlShaderProgramInterfaceAttribute"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShaderProgramInterfaceAttribute">[docs]</a><span class="k">class</span> <span class="nc">GlShaderProgramInterfaceAttribute</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; This class defines a programming interface for an attribute as a pair (name, location)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c">##############################################</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">location</span>

    <span class="c">##############################################</span>
    
<div class="viewcode-block" id="GlShaderProgramInterfaceAttribute.bind_to_buffer"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShaderProgramInterfaceAttribute.bind_to_buffer">[docs]</a>    <span class="k">def</span> <span class="nf">bind_to_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vbo</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Bind the vertex attribute to a Vertex Buffer Object. &quot;&quot;&quot;</span>

        <span class="n">vbo</span><span class="o">.</span><span class="n">bind_at_location</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">)</span>

<span class="c">####################################################################################################</span>
</div></div>
<div class="viewcode-block" id="GlShaderProgramInterface"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShaderProgramInterface">[docs]</a><span class="k">class</span> <span class="nc">GlShaderProgramInterface</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; This class defines a programming interface for a program.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c">##############################################</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniform_blocks</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_init_uniform_blocks</span><span class="p">(</span><span class="n">uniform_blocks</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_attributes</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>

    <span class="c">##############################################</span>
    
<div class="viewcode-block" id="GlShaderProgramInterface._init_uniform_blocks"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShaderProgramInterface._init_uniform_blocks">[docs]</a>    <span class="k">def</span> <span class="nf">_init_uniform_blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniform_blocks</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">uniform_blocks</span> <span class="o">=</span> <span class="n">AttributeDictionaryInterface</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">binding_point</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">uniform_blocks</span><span class="p">):</span>
            <span class="n">pair</span> <span class="o">=</span> <span class="n">GlShaderProgramInterfaceUniformBlock</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">binding_point</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uniform_blocks</span><span class="o">.</span><span class="n">_dictionary</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pair</span>

    <span class="c">##############################################</span>
    </div>
<div class="viewcode-block" id="GlShaderProgramInterface._init_attributes"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShaderProgramInterface._init_attributes">[docs]</a>    <span class="k">def</span> <span class="nf">_init_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attributes</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">AttributeDictionaryInterface</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">location</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">attributes</span><span class="p">):</span>
            <span class="n">pair</span> <span class="o">=</span> <span class="n">GlShaderProgramInterfaceAttribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">_dictionary</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">pair</span>

<span class="c">####################################################################################################</span>
</div></div>
<div class="viewcode-block" id="GlShaderProgram"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShaderProgram">[docs]</a><span class="k">class</span> <span class="nc">GlShaderProgram</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; This class defines a shader program.</span>

<span class="sd">    We can access the uniforms and vertex attributes defined in the shader program using the two</span>
<span class="sd">    class attributes: *uniforms* and *attributes*, respectively.  Both act as class that has an</span>
<span class="sd">    attribute for each uniform and vertex attribute.</span>

<span class="sd">    For example we can set a *colour* uniform using::</span>

<span class="sd">      shader_program.uniforms.colour = (1., 1., 1.)</span>

<span class="sd">    and get back its values using::</span>

<span class="sd">      shader_program.uniforms.colour</span>

<span class="sd">    We can also use a dictionary interface::</span>

<span class="sd">       # to set the values</span>
<span class="sd">       shader_program.uniforms[&#39;colour&#39;] = (1., 1., 1.)</span>
<span class="sd">       # to get the values</span>
<span class="sd">       shader_program.uniforms[&#39;colour&#39;]</span>

<span class="sd">    Moreover we can test if an uniform is defined using::</span>

<span class="sd">      &#39;colour&#39; in shader_program.uniforms</span>

<span class="sd">    Similarly, we can access a vertex attribute using::</span>

<span class="sd">      shader_program.attributes.positions</span>

<span class="sd">    For example to attach a VBO::</span>

<span class="sd">      shader_program.attributes.positions.bind_to_buffer(positions_vbo)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_logger</span> <span class="o">=</span> <span class="n">_module_logger</span><span class="o">.</span><span class="n">getChild</span><span class="p">(</span><span class="s">&#39;GlShaderProgram&#39;</span><span class="p">)</span>

    <span class="c">##############################################</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">program_id</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">glCreateProgram</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_linked</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_active</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">uniforms</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uniform_blocks</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="c">##############################################</span>
    
    <span class="k">def</span> <span class="nf">__delx__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="p">(</span><span class="s">&quot;Delete Program </span><span class="si">%u</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">program_id</span><span class="p">))</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glDeleteProgram</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">program_id</span><span class="p">)</span>

    <span class="c">##############################################</span>
    
<div class="viewcode-block" id="GlShaderProgram.attach_shader"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShaderProgram.attach_shader">[docs]</a>    <span class="k">def</span> <span class="nf">attach_shader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shader</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Attach a shader. &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">(</span><span class="n">shader</span><span class="p">):</span>
            <span class="n">shader</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>

        <span class="n">GL</span><span class="o">.</span><span class="n">glAttachShader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">program_id</span><span class="p">,</span> <span class="n">shader</span><span class="o">.</span><span class="n">_shader_id</span><span class="p">)</span>

    <span class="c">##############################################</span>
    </div>
<div class="viewcode-block" id="GlShaderProgram.link"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShaderProgram.link">[docs]</a>    <span class="k">def</span> <span class="nf">link</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Link the program. &quot;&quot;&quot;</span>

        <span class="n">GL</span><span class="o">.</span><span class="n">glLinkProgram</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">program_id</span><span class="p">)</span>

        <span class="n">length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glGetProgramiv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">program_id</span><span class="p">,</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_INFO_LOG_LENGTH</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span>
        <span class="n">log</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">GL</span><span class="o">.</span><span class="n">glGetProgramInfoLog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">program_id</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">length</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">Link program &#39;</span><span class="si">%s</span><span class="s">&#39;</span>
<span class="s">Log:</span>
<span class="s">  -----------------------------------------------------------------------------</span>
<span class="si">%s</span><span class="s"></span>
<span class="s">  -----------------------------------------------------------------------------</span>
<span class="s">&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">message</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="n">log</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">GL_Ext</span><span class="o">.</span><span class="n">glGetProgramiv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">program_id</span><span class="p">,</span> <span class="n">GL</span><span class="o">.</span><span class="n">GL_LINK_STATUS</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">log</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_linked</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">uniforms</span> <span class="o">=</span> <span class="n">GlShaderProgramUniforms</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uniform_blocks</span> <span class="o">=</span> <span class="n">GlShaderProgramUniformBlocks</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">GlShaderProgramAttributes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="c">##############################################</span>
    </div>
<div class="viewcode-block" id="GlShaderProgram.unbind"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShaderProgram.unbind">[docs]</a>    <span class="k">def</span> <span class="nf">unbind</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Unbind the shader. &quot;&quot;&quot;</span>

        <span class="n">GL</span><span class="o">.</span><span class="n">glUseProgram</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_active</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="c">##############################################</span>
    </div>
<div class="viewcode-block" id="GlShaderProgram.bind"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShaderProgram.bind">[docs]</a>    <span class="k">def</span> <span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Bind the shader. &quot;&quot;&quot;</span>

        <span class="n">GL</span><span class="o">.</span><span class="n">glUseProgram</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">program_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_active</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="c">##############################################</span>
    </div>
<div class="viewcode-block" id="GlShaderProgram.bind_attribute_location_array"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShaderProgram.bind_attribute_location_array">[docs]</a>    <span class="k">def</span> <span class="nf">bind_attribute_location_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Bind an attribute location. The program should not be linked. &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linked</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&quot;Attribute location binding must be done before linking.&quot;</span><span class="p">)</span>

        <span class="n">GL</span><span class="o">.</span><span class="n">glBindAttribLocation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">program_id</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="c">##############################################</span>
    </div>
<div class="viewcode-block" id="GlShaderProgram.set_program_interface"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShaderProgram.set_program_interface">[docs]</a>    <span class="k">def</span> <span class="nf">set_program_interface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">program_interface</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Set the programming interface. &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">interface</span> <span class="o">=</span> <span class="n">program_interface</span>
        <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">attributes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bind_attribute_location_array</span><span class="p">(</span><span class="n">attribute</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">attribute</span><span class="o">.</span><span class="n">location</span><span class="p">)</span>

    <span class="c">##############################################</span>
    </div>
<div class="viewcode-block" id="GlShaderProgram.set_uniform_block_binding"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShaderProgram.set_uniform_block_binding">[docs]</a>    <span class="k">def</span> <span class="nf">set_uniform_block_binding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">binding_point</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Set the binding point for an uniform block. &quot;&quot;&quot;</span>

        <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniform_blocks</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">uniform_block_location</span><span class="p">()</span>
        <span class="n">GL</span><span class="o">.</span><span class="n">glUniformBlockBinding</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">program_id</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">binding_point</span><span class="p">)</span>

    <span class="c">##############################################</span>
    </div>
<div class="viewcode-block" id="GlShaderProgram.set_uniform_block_bindings"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShaderProgram.set_uniform_block_bindings">[docs]</a>    <span class="k">def</span> <span class="nf">set_uniform_block_bindings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Set the uniform block binding points as defined by the programming interface. &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">uniform_block</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">uniform_blocks</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_uniform_block_binding</span><span class="p">(</span><span class="n">uniform_block</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">uniform_block</span><span class="o">.</span><span class="n">binding_point</span><span class="p">)</span>

    <span class="c">##############################################</span>
    </div>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">text</span> <span class="o">=</span> <span class="s">&quot;Shader Program &#39;</span><span class="si">%s</span><span class="s">&#39;:</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s">&#39;Uniform Blocks:</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="k">for</span> <span class="n">uniform_block</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniform_blocks</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uniform_block</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s">&#39;Uniforms:</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="k">for</span> <span class="n">uniform</span> <span class="ow">in</span> <span class="n">sorted_by_location</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uniforms</span><span class="p">):</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s">&#39; - </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">uniform</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="s">&#39;Attributes:</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">sorted_by_location</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attributes</span><span class="p">):</span>
            <span class="n">text</span> <span class="o">+=</span> <span class="s">&#39; - </span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">attribute</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">text</span>

<span class="c">####################################################################################################</span>
</div>
<div class="viewcode-block" id="GlShaderManager"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShaderManager">[docs]</a><span class="k">class</span> <span class="nc">GlShaderManager</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot; This class provides a shader manager where each shader or program are identified by a name</span>
<span class="sd">    and the shader sources are loaded from files.</span>

<span class="sd">    The shaders or programs can be accessed using an attribute or a dictionary interface. For</span>
<span class="sd">    example to get the shader *fixed_fragment* we can use either::</span>

<span class="sd">      shader_manager.fixed_fragment</span>
<span class="sd">      shader_manager.[&#39;fixed_fragment&#39;]</span>

<span class="sd">    We can test if an identifier exists using::</span>

<span class="sd">      &#39;fixed_fragment&#39; in shader_manager</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">SingletonMetaClass</span>

    <span class="c"># Fixme: -&gt; attributeDictionaryInterface</span>

    <span class="c">##############################################</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_shaders</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_programs</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c">##############################################</span>
    
    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>

        <span class="k">return</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shaders</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_programs</span>

    <span class="c">##############################################</span>
    
    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>

        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_programs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_shaders</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">item</span>

    <span class="c">##############################################</span>
    
    <span class="n">__getitem__</span> <span class="o">=</span> <span class="n">__getattr__</span>

    <span class="c">##############################################</span>
    
<div class="viewcode-block" id="GlShaderManager.has_visual"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShaderManager.has_visual">[docs]</a>    <span class="k">def</span> <span class="nf">has_visual</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">GL</span><span class="o">.</span><span class="n">glCreateShader</span><span class="p">)</span>

    <span class="c">##############################################</span>
    </div>
<div class="viewcode-block" id="GlShaderManager.load_from_file"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShaderManager.load_from_file">[docs]</a>    <span class="k">def</span> <span class="nf">load_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shader_name</span><span class="p">,</span> <span class="n">shader_file_name</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Load a shader from a source file and compile it. This shader is identified by</span>
<span class="sd">        *shader_name*.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">shader_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&quot;Shader </span><span class="si">%s</span><span class="s"> is already defined&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">shader_name</span><span class="p">))</span>

        <span class="n">shader</span> <span class="o">=</span> <span class="n">GlShader</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="n">shader_file_name</span><span class="p">)</span>
        <span class="n">shader</span><span class="o">.</span><span class="n">compile</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_shaders</span><span class="p">[</span><span class="n">shader_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">shader</span>

        <span class="k">return</span> <span class="n">shader</span>

    <span class="c">##############################################</span>
    </div>
<div class="viewcode-block" id="GlShaderManager.link_program"><a class="viewcode-back" href="../../../api/PyOpenGLng/HighLevelApi/Shader.html#PyOpenGLng.HighLevelApi.Shader.GlShaderManager.link_program">[docs]</a>    <span class="k">def</span> <span class="nf">link_program</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">program_name</span><span class="p">,</span> <span class="n">shader_list</span><span class="p">,</span>
                     <span class="n">program_interface</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                     <span class="n">shader_program_class</span><span class="o">=</span><span class="n">GlShaderProgram</span><span class="p">,</span>
                     <span class="n">shader_program_args</span><span class="o">=</span><span class="p">(),</span>
                     <span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; Link a program with the given list of shader names. This program is identified by</span>
<span class="sd">        *shader_name*.  The argument *program_interface* can be used to set the program interface.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">program_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s">&quot;Program </span><span class="si">%s</span><span class="s"> is already defined&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">program_name</span><span class="p">))</span>

        <span class="n">shader_program</span> <span class="o">=</span> <span class="n">shader_program_class</span><span class="p">(</span><span class="n">program_name</span><span class="p">,</span> <span class="o">*</span><span class="n">shader_program_args</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">shader_name</span> <span class="ow">in</span> <span class="n">shader_list</span><span class="p">:</span>
            <span class="n">shader_program</span><span class="o">.</span><span class="n">attach_shader</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">shader_name</span><span class="p">])</span>
        <span class="c"># Fixme: move to link ?</span>
        <span class="k">if</span> <span class="n">program_interface</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">shader_program</span><span class="o">.</span><span class="n">set_program_interface</span><span class="p">(</span><span class="n">program_interface</span><span class="p">)</span>
        <span class="n">shader_program</span><span class="o">.</span><span class="n">link</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">program_interface</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">shader_program</span><span class="o">.</span><span class="n">set_uniform_block_bindings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_programs</span><span class="p">[</span><span class="n">program_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">shader_program</span>

        <span class="k">return</span> <span class="n">shader_program</span>

<span class="c">####################################################################################################</span>
<span class="c">#</span>
<span class="c"># End</span>
<span class="c">#</span>
<span class="c">####################################################################################################</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">PyOpenGLng 0.1.0 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Fabrice Salvaire.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>